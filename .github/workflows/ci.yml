name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  typescript:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "18"
      - name: Install dependencies
        run: npm install
      - name: Build TypeScript
        run: npm run build
      - name: Run tests
        run: npm test

  c-build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build C skeleton
        run: cd c-skel && make all
      - name: Test C skeleton
        run: cd c-skel && make test

  rust-build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - name: Build Rust skeleton
        run: cd rust-skel && cargo build --release
      - name: Test Rust skeleton
        run: cd rust-skel && cargo test

  riscv-cross:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install RISC-V toolchain
        run: |
          sudo apt-get update
          sudo apt-get install -y gcc-riscv64-unknown-elf || echo "RISC-V GCC not available, skipping"
      - name: Cross-compile C to RISC-V
        run: cd c-skel && make riscv || echo "RISC-V cross-compile skipped"
