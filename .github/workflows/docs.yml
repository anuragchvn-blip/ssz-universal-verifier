name: Documentation

on:
  push:
    branches: [main, master]
    paths:
      - 'docs/**'
      - 'README.md'
      - '.github/workflows/docs.yml'
  workflow_dispatch:

jobs:
  check-docs:
    name: Check Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Check for broken links
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'yes'
          use-verbose-mode: 'yes'
          config-file: '.github/markdown-link-check.json'
        continue-on-error: true
      
      - name: Verify documentation completeness
        run: |
          echo "Checking documentation files..."
          test -f docs/API.md || { echo "Missing docs/API.md"; exit 1; }
          test -f docs/INTEGRATION.md || { echo "Missing docs/INTEGRATION.md"; exit 1; }
          test -f README.md || { echo "Missing README.md"; exit 1; }
          echo "All required documentation files present"
      
      - name: Check documentation structure
        run: |
          echo "Verifying API.md structure..."
          grep -q "## TypeScript API" docs/API.md || { echo "Missing TypeScript section"; exit 1; }
          grep -q "## Rust API" docs/API.md || { echo "Missing Rust section"; exit 1; }
          grep -q "## C API" docs/API.md || { echo "Missing C section"; exit 1; }
          
          echo "Verifying INTEGRATION.md structure..."
          grep -q "## Quick Start" docs/INTEGRATION.md || { echo "Missing Quick Start"; exit 1; }
          grep -q "## TypeScript Integration" docs/INTEGRATION.md || { echo "Missing TS integration"; exit 1; }
          grep -q "## Rust Integration" docs/INTEGRATION.md || { echo "Missing Rust integration"; exit 1; }
          
          echo "Documentation structure verified"
      
      - name: Generate documentation summary
        run: |
          echo "# Documentation Summary" > docs-summary.md
          echo "" >> docs-summary.md
          echo "## Files" >> docs-summary.md
          wc -l docs/*.md README.md >> docs-summary.md
          echo "" >> docs-summary.md
          echo "## Coverage" >> docs-summary.md
          echo "- TypeScript API: Complete" >> docs-summary.md
          echo "- Rust API: Complete" >> docs-summary.md
          echo "- C API: Complete" >> docs-summary.md
          echo "- Integration guides: Complete" >> docs-summary.md
          cat docs-summary.md
      
      - name: Upload documentation summary
        uses: actions/upload-artifact@v4
        with:
          name: docs-summary
          path: docs-summary.md
